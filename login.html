<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Log in</title>
    <link
      href="https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link rel="icon" type="image/png" href="img/Logo_fab_cvl_studio.png" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bcryptjs/2.4.3/bcrypt.min.js"></script>
  </head>
  <body>
   <main>
        <div class="box">
          <div class="inner-box">
            <div class="forms-wrap">
                <form action="inde.html" autocomplete="off" class="sign-in-form">
                    <div class="logo">
                        <img src="./img/Logo_fab_cvl_studio.png" alt="The Fab Studio">
                        <h3>The Fab Studio</h3>
                    </div>

                    <div class="heading">
                        <h2>Bienvenue</h2>
                        <h6>Pas encore enregistré?</h6>
                        <a href="#" class="toggle">S'inscrire</a>
                    </div>

                    <div class="actual-form">
                        <div class="input-wrap">
                            <input type="text" minlength="4" class="input-field" autocomplete="off" id="email" required>
                            <label >Email</label>
                        </div>
                        <div class="input-wrap">
                            <input type="password" minlength="4" class="input-field" autocomplete="off" id="password" required>
                            <label >Mot de passe</label>
                        </div>
                        <input type="submit" value="Sign In" class="Sign-btn" onclick="login()">
                        <p class="text">
                            Vous avez oublié votre mot de passe ou vos données de connexion ?
                            <a href="#">Obtenir de l'aide</a> pour se connecter
                        </p>
                    </div>
                </form>
                <form action="inde.html" autocomplete="off" class="sign-up-form">
                    <div class="logo">
                       <img src="./img/Logo_fab_cvl_studio.png" alt="The Fab Studio">
                        <h3>The Fab Studio</h3>
                    </div>

                    <div class="heading">
                        <h2>Commencer</h2>
                        <h6>Vous avez déjà un compte ?</h6>
                        <a href="#" class="toggle">Se connecter</a>
                    </div>

                    <div class="actual-form">
                        <div class="input-wrap">
                            <input type="text" minlength="4" class="input-field" autocomplete="off" id="name" required>
                            <label >Nom</label>
                        </div>
                        <div class="input-wrap">
                            <input type="email"  class="input-field" autocomplete="off" id="email_s" required>
                            <label >Email</label>
                        </div>
                        <div id="emailValidationMessage"></div>
                        <div class="input-wrap">
                            <input type="password" minlength="4" class="input-field" autocomplete="off" id="password_s" required>
                            <label >Mot de passe</label>
                        </div>
                        <input type="submit" value="Sign Up" class="Sign-btn" onclick="register()">
                        <p class="text">
                           En m'inscrivant, j'accepte les <a href="#">Conditions d'utilisation</a> et <a href="#">Politique de confidentialité</a>.
                        </p>
                    </div>
                </form>
            </div>
            <div class="carousel">
                <div class="images-wrapper">
              <img src="./img/login.png" class="image img-1 show" alt="" />
              <img src="./img/login2.png" class="image img-2" alt="" />
              <img src="./img/login3.png" class="image img-3" alt="" />
            </div>

            <div class="text-slider">
              <div class="text-wrap">
                <div class="text-group">
                  <h2>Créer des milliers de sites</h2>
                  <h2>Personalisés vos sites comme vous voulez</h2>
                  <h2>Partager au monde entier votre site</h2>
                </div>
              </div>

              <div class="bullets">
                <span class="active" data-value="1"></span>
                <span data-value="2"></span>
                <span data-value="3"></span>
              </div>
            </div>
          </div>
          </div>
        </div>
        </div>
      </main>











    
  
    <div class="validation">
      <ul>
        <li class="invalid">
          <i class="bx bx-circle"></i> Au moins une lettre minuscule
        </li>
        <li class="invalid">
          <i class="bx bx-circle"></i> Au moins une lettre majuscule
        </li>
        <li class="invalid">
          <i class="bx bx-circle"></i> Au moins une chiffre
        </li>
        <li class="invalid">
          <i class="bx bx-circle"></i> Au moins une charactère spécial
        </li>
        <li class="invalid">
          <i class="bx bx-circle"></i> Au moins 8 charactère
        </li>
      </ul>
    </div>
  </body>

  <style>
    /* style.css */
    @import url("https://fonts.googleapis.com/css2?family=Montserrat&display=swap");
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Montserrat";
      scroll-behavior: smooth;
    }
    
@import url("https://fonts.googleapis.com/css2?family=Montserrat&display=swap");


body,input{
    font-family: "Montserrat", sans-serif;
}
main{
    width: 100%;
    min-height: 100vh;
    overflow: hidden;
    background-color: #ff8c6b;
    padding: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

.box{
    position: relative;
    width: 100%;
    max-width: 1020px;
    height: 640px;
    background-color: #fff;
    border-radius: 3.3rem;
    box-shadow: 0 60px 40px -30px rgba(0,0,0,0.27);
}

.inner-box{
position: absolute;
width: calc(100% - 4.1rem);
height: calc(100% - 4.1rem);
top: 50%;
left: 50%;
transform: translate(-50%,-50%);

}

.forms-wrap{
    position: absolute;
    height: 100%;
    width: 45%;
    top: 0;
    left: 0;
display: grid;
grid-template-columns: 1fr;
grid-template-rows: 1fr;
transition: 0.8s ease-in-out;
}

form{
    max-width: 260px;
    width: 100%;
    margin: 0 auto;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-evenly;
    grid-column: 1 / 2;
    grid-row: 1 / 2;
    transition: opacity 0.02s 0.4s ;
}
form.sign-up-form{
    opacity: 0;
    pointer-events: none;
}
.logo{
    display: flex;
    align-items: center;
}
.logo img{
    width: 27px;
    margin-right: 0.3rem;
  border-radius: 0.3rem;
}

.logo h4{
    font-size: 1.1rem;
margin-top: -9px;
letter-spacing: -0.5px;
color: #151111;
}
.heading h2{
    font-size: 2.1rem;
    font-weight: 600;
    color: #151111;
}
.heading h6{
    color: #bababa;
    font-weight: 400;
    font-size: .75rem;
    display: inline;
}
.toggle{
    color: #151111;
    text-decoration: none;
    font-size: 0.75rem;
font-weight: 500;
transition: 0.3s;
}
.toggle:hover{
    color: #8371fd;
}
.input-wrap{
    position: relative;
    height: 37px;
    margin-bottom: 2rem;
}
.input-field{
    position: absolute;
    width: 100%;
    height: 100%;
    background: none;
    border: none;
    outline: none;
    border-bottom: 1px solid #bbb;
    padding: 0;
    font-size: 0.95rem;
    color: #151111;
    transition: 0.4s;
}
label{
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.95rem;
    color: #bbb;
    pointer-events: none;
    transition: 0.4s;
}
.input-field.active{
    border-bottom-color: #151111;
}
.input-field.active + label{
  font-size: 0.75rem;
  top: -2px;
}
.Sign-btn{
    display: inline-block;
    width: 100%;
    height: 43px;
    background-color: #151111;
    color: #fff;
    border: none;
    cursor: pointer;
    border-radius: 0.8rem;
    font-size: 0.8rem;
    margin-bottom: 2rem;
    transition: 0.3s;

}
.Sign-btn:hover{
    background-color: #8371fd;
}
.text{
    color: #bbb;
    font-size: 0.7rem;
}
.text a{
    color: #bbb;
    transition: 0.3s;
}
.text a:hover{
    color: #8371fd;
}

main.sign-up-mode form.sign-in-form{
opacity: 0;
pointer-events: none;
}
main.sign-up-mode form.sign-up-form{
opacity: 1;
pointer-events: all;
}
main.sign-up-mode .forms-wrap{
    left: 55%;
}

main.sign-up-mode .carousel{
    left: 0%;
}
    .carousel {
  position: absolute;
  height: 100%;
  width: 55%;
  left: 45%;
  top: 0;
  background-color: #ffe0d2;
  border-radius: 2rem;
  display: grid;
  grid-template-rows: auto 1fr;
  padding-bottom: 2rem;
  overflow: hidden;
  transition: 0.8s ease-in-out;
}

.images-wrapper {
  display: grid;
  grid-template-columns: 1fr;
  grid-template-rows: 1fr;
}

.image {
  width: 100%;
  grid-column: 1/2;
  grid-row: 1/2;
  opacity: 0;
  transition: opacity 0.3s, transform 0.5s;
}

.img-1 {
  transform: translate(0, -50px);
}

.img-2 {
  transform: scale(0.4, 0.5);
}

.img-3 {
  transform: scale(0.3) rotate(-20deg);
}

.image.show {
  opacity: 1;
  transform: none;
}

.text-slider {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}

.text-wrap {
  max-height: 2.2rem;
  overflow: hidden;
  margin-bottom: 2.5rem;
}

.text-group {
  display: flex;
  flex-direction: column;
  text-align: center;
  transform: translateY(0);
  transition: 0.5s;
}

.text-group h2 {
  line-height: 2.2rem;
  font-weight: 600;
  font-size: 1.6rem;
}

.bullets {
  display: flex;
  align-items: center;
  justify-content: center;
}

.bullets span {
  display: block;
  width: 0.5rem;
  height: 0.5rem;
  background-color: #aaa;
  margin: 0 0.25rem;
  border-radius: 50%;
  cursor: pointer;
  transition: 0.3s;
}

.bullets span.active {
  width: 1.1rem;
  background-color: #151111;
  border-radius: 1rem;
}

@media (max-width: 850px) {
  .box {
    height: auto;
    max-width: 550px;
    overflow: hidden;
  }

  .inner-box {
    position: static;
    transform: none;
    width: revert;
    height: revert;
    padding: 2rem;
  }

  .forms-wrap {
    position: revert;
    width: 100%;
    height: auto;
  }

  form {
    max-width: revert;
    padding: 1.5rem 2.5rem 2rem;
    transition: transform 0.8s ease-in-out, opacity 0.45s linear;
  }

  .heading {
    margin: 2rem 0;
  }

  form.sign-up-form {
    transform: translateX(100%);
  }

  main.sign-up-mode form.sign-in-form {
    transform: translateX(-100%);
  }

  main.sign-up-mode form.sign-up-form {
    transform: translateX(0%);
  }

  .carousel {
    position: revert;
    height: auto;
    width: 100%;
    padding: 3rem 2rem;
    display: flex;
  }

  .images-wrapper {
    display: none;
  }

  .text-slider {
    width: 100%;
  }
}

@media (max-width: 530px) {
  main {
    padding: 1rem;
  }

  .box {
    border-radius: 2rem;
  }

  .inner-box {
    padding: 1rem;
  }

  .carousel {
    padding: 1.5rem 1rem;
    border-radius: 1.6rem;
  }

  .text-wrap {
    margin-bottom: 1rem;
  }

  .text-group h2 {
    font-size: 1.2rem;
  }

  form {
    padding: 1rem 2rem 1.5rem;
  }
}
#emailValidationMessage {
color: #e01d1d;
transform: translateY(-15px);
}
    
    * {
      --input-focus: #2d8cf0;
      --font-color: #323232;
      --font-color-sub: #666;
      --bg-color: #fff;
      --bg-color-alt: #66666688;
      --main-color: #323232;
    }
   
    .validation {
      display: none;
   background: #ffffff7a;
    backdrop-filter: blur(5px);
    padding: 20px;
    transition: all 0.5s ease-in-out;
    font-size: 17px;
    position: absolute;
    top: 0%;
    left: 25%;
    transform: translate(50%, -150%);
    border-radius: 0.75em;
    }

    .validation ul {
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .validation ul li {
      position: relative;
    list-style: none;
    color: #151111;
    display: flex;
    align-items: center;
    background: #ff8c6b;
    font-size: 0.85em;
    transition: 0.5s;
    border-radius: 0.75em;
    padding: 0.5rem;
    }

    .validation ul li.valid {
      color: #fff;
    }

    .validation ul li::before {
      width: 20px;
      height: 10px;
      display: inline-flex;
    }

    .validation ul li i .valid::before {
      color: #fff;
    }
  </style>

  <script>
const inputs = document.querySelectorAll(".input-field");
const toggle_btn = document.querySelectorAll(".toggle");
const main = document.querySelector("main");
const bullets = document.querySelectorAll(".bullets span");
const images = document.querySelectorAll(".image");

inputs.forEach((inp) => {
  inp.addEventListener("focus", () => {
    inp.classList.add("active");
  });
  inp.addEventListener("blur", () => {
    if (inp.value != "") return;
    inp.classList.remove("active");
  });
});

toggle_btn.forEach((btn) => {
  btn.addEventListener("click", () => {
    main.classList.toggle("sign-up-mode");
  });
});

function moveSlider() {
  let index = this.dataset.value;

  let currentImage = document.querySelector(`.img-${index}`);
  images.forEach((img) => img.classList.remove("show"));
  currentImage.classList.add("show");

  const textSlider = document.querySelector(".text-group");
  textSlider.style.transform = `translateY(${-(index - 1) * 2.2}rem)`;

  bullets.forEach((bull) => bull.classList.remove("active"));
  this.classList.add("active");
}

bullets.forEach((bullet) => {
  bullet.addEventListener("click", moveSlider);
});
    const emailInput = document.getElementById("email_s");
    const passwordInput2 = document.getElementById("password_s");
    const email = document.getElementById("email");
    const validationList = document.querySelector(".validation ul");
    const validation = document.querySelector(".validation");
    const emailValidationMessage = document.getElementById(
      "emailValidationMessage"
    );

    function validateEmail(email) {
      const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return regex.test(email);
    }

    // Événement déclenché lorsqu'une touche est relâchée dans le champ de l'adresse e-mail
    emailInput.addEventListener("keyup", (event) => {
      const email = event.target.value;
      if (validateEmail(email)) {
        emailInput.classList.remove("invalid");
        emailInput.classList.add("valid");
        emailValidationMessage.innerHTML = "";
        emailValidationMessage.style.display = "none";
      } else {
        emailInput.classList.remove("valid");
        emailInput.classList.add("invalid");
        emailValidationMessage.innerHTML = "L'adresse e-mail n'est pas valide.";
        emailValidationMessage.style.display = "block";
      }
    });
    function checkPassword(password) {
      // Expression régulière pour vérifier chaque critère
      const lowercaseRegex = /[a-z]/;
      const uppercaseRegex = /[A-Z]/;
      const numberRegex = /[0-9]/;
      const specialCharRegex = /[ !"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]/;
      const lengthRegex = /.{8,}/;

      // Vérification de chaque critère et mise à jour de l'état de la liste de validation
      const criteria = [
        {
          id: "Au moins une lettre minuscule",
          regex: lowercaseRegex.test(password),
        },
        {
          id: "Au moins une lettre majuscule",
          regex: uppercaseRegex.test(password),
        },
        { id: "Au moins une chiffre", regex: numberRegex.test(password) },
        {
          id: "Au moins une charactère spécial",
          regex: specialCharRegex.test(password),
        },
        { id: "Au moins 8 charactère", regex: lengthRegex.test(password) },
      ];

      // Réinitialisation de la liste de validation
      validationList.innerHTML = "";

      // Mise à jour de l'état de chaque critère dans la liste de validation
      criteria.forEach((criterion) => {
        const listItem = document.createElement("li");
        const icon = document.createElement("i");

        if (criterion.regex) {
          icon.classList.add("bx", "bx-check-circle");
          listItem.classList.add("valid");
        } else {
          icon.classList.add("bx", "bx-circle");
          listItem.classList.add("invalid");
        }

        listItem.appendChild(icon);
        listItem.appendChild(document.createTextNode(` ${criterion.id}`));

        validationList.appendChild(listItem);
      });
    }

    // Événement déclenché lorsqu'une touche est relâchée dans le champ de mot de passe
    passwordInput2.addEventListener("keyup", (event) => {
      const password = event.target.value;

    
    validation.style.display = "block";
      setTimeout(() => {
        validation.style.transform = "translate(50%, 0%)";
      }, 100);

      checkPassword(password);
    });
    email.addEventListener("keyup", (event) => {
     

    
        validation.style.transform = "translate(50%, -150%)";
      setTimeout(() => {
    validation.style.display = "none";
      }, 100);

    
    });

    function register() {
      // Sélection des éléments DOM
      const nameInput = document.getElementById("name");
      const emailInput = document.getElementById("email_s");

      const passwordInput = document.getElementById("password_s");

      const nameValue = nameInput.value.trim();
      const emailValue = emailInput.value.trim();
      const passwordValue = passwordInput.value.trim();
      // Fonction pour vérifier si tous les champs sont remplis
      if (nameValue === "" || emailValue === "" || passwordValue === "") {
        alert("Veuillez remplir les champs");
        return; // Sortir de la fonction si un champ est vide
      } else {
        // Vérifier si le mot de passe respecte les critères
        const lowercaseRegex = /[a-z]/;
        const uppercaseRegex = /[A-Z]/;
        const numberRegex = /[0-9]/;
        const specialCharRegex = /[ !"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]/;
        const lengthRegex = /.{8,}/;

        const isValidPassword =
          lowercaseRegex.test(passwordValue) &&
          uppercaseRegex.test(passwordValue) &&
          numberRegex.test(passwordValue) &&
          specialCharRegex.test(passwordValue) &&
          lengthRegex.test(passwordValue);

        if (!isValidPassword) {
          alert(
            "Le mot de passe doit respecter les critères suivants :\n- Au moins une lettre minuscule\n- Au moins une lettre majuscule\n- Au moins un chiffre\n- Au moins un caractère spécial\n- Au moins 8 caractères"
          );
          return; // Sortir de la fonction si le mot de passe ne respecte pas les critères
        }
      }

      // Ajouter des gestionnaires d'événements aux champs d'entrée pour surveiller les changements

      const request = window.indexedDB.open("MaBaseDeDonnees", 1);

      // Gérer les événements associés à la requête
      request.addEventListener("success", function (event) {
        const db = event.target.result;
        const transaction = db.transaction(["Compte"], "readonly");
        const objectStore = transaction.objectStore("Compte");
        const index = objectStore.index("User"); // Créez un index sur l'e-mail
        function generateUserId() {
          return "user_" + Math.random().toString(36).substr(2, 9);
        }
        // Récupérez l'e-mail saisi par l'utilisateur
        const email = document.getElementById("email_s").value;

        // Effectuez une recherche dans l'index pour vérifier si l'e-mail existe déjà
        const getRequest = index.get(email);

        getRequest.onsuccess = function (event) {
          const existingAccount = event.target.result;

          if (existingAccount) {
            // Un compte avec cet e-mail existe déjà
            alert(
              "Un compte avec cet e-mail existe déjà. Veuillez utiliser une autre adresse e-mail."
            );
          } else {
            // Aucun compte avec cet e-mail n'existe, vous pouvez ajouter le nouveau compte
            const userId = generateUserId();
            const name = document.getElementById("name").value;
            const password_before = document.getElementById("password_s").value;
            function addToDatabase(variableName, variableValue) {
              // Assurez-vous que la base de données est ouverte
              if (!db) {
                console.error("La base de données n'est pas ouverte.");
                return;
              }

              // Utilisez db pour ajouter la variable à la base de données
              const transaction = db.transaction(["Compte"], "readwrite");
              const objectStore = transaction.objectStore("Compte");

              const request = objectStore.put({
                username: variableName,
                id: userId,
                value: variableValue,
              });

              // Gérez les événements de la requête si nécessaire
              request.onsuccess = function (event) {
                console.log(
                  "Variable ajoutée avec succès à la base de données."
                );
                function getFormattedDateTime() {
                  const currentTime = new Date();

                  // Obtention des composants de la date
                  const day = currentTime.getDate();
                  const month = currentTime.getMonth() + 1; // Les mois sont indexés à partir de 0
                  const year = currentTime.getFullYear();

                  // Formater la date au format "dd-mm-yyyy"
                  const formattedDate = `${day < 10 ? "0" : ""}${day}-${
                    month < 10 ? "0" : ""
                  }${month}-${year}`;

                  // Obtention des composants de l'heure
                  const hours = currentTime.getHours();
                  const minutes = currentTime.getMinutes();

                  // Formater l'heure au format "hh:mm"
                  const formattedTime = `${hours < 10 ? "0" : ""}${hours}:${
                    minutes < 10 ? "0" : ""
                  }${minutes}`;

                  // Concaténer la date et l'heure dans la chaîne de caractères finale
                  return `${formattedDate} ${formattedTime}`;
                }
                updateDateTimeInUpdating();
                function updateDateTimeInUpdating() {
                  const formattedDateTime = getFormattedDateTime();
                  // Mettre à jour l'heure dans Updating
                  const transaction = db.transaction(["Updating"], "readwrite");
                  const objectStore = transaction.objectStore("Updating");
                  objectStore.put({
                    MAJ: formattedDateTime,
                    update: "maj_hour",
                  });
                }
              };

              request.onerror = function (event) {
                console.error(
                  "Erreur lors de l'ajout de la variable à la base de données.",
                  event.target.error
                );
              };
            }

            async function hashPassword(password) {
              // Convert password to ArrayBuffer
              const encoder = new TextEncoder();
              const data = encoder.encode(password);

              // Generate a salt
              const salt = crypto.getRandomValues(new Uint8Array(16));

              // Combine password and salt
              const saltedData = new Uint8Array(data.length + salt.length);
              saltedData.set(salt);
              saltedData.set(data, salt.length);

              // Hash the salted password
              const hashBuffer = await crypto.subtle.digest(
                "SHA-256",
                saltedData
              );
              const hashArray = Array.from(new Uint8Array(hashBuffer));

              // Convert hash to hex string
              const hashHex = hashArray
                .map((b) => b.toString(16).padStart(2, "0"))
                .join("");

              // Convert salt to hex string
              const saltHex = Array.from(salt)
                .map((b) => b.toString(16).padStart(2, "0"))
                .join("");

              // Return the combined salt and hash
              return `${saltHex}:${hashHex}`;
            }
            (async () => {
              const password = await hashPassword(password_before);

              // Ajoutez le nouveau compte à la base de données
              addToDatabase(
                email,
                JSON.stringify({ userId, name, email, password })
              );
            })();

            // Affichez un message de succès
            alert("Compte créé avec succès!");
            const validation = document.querySelector(".validation");
            validation.style.dispay = "none";
            const toggle = document.querySelector(".toggle");
            toggle.checked = false;
          }
        };

        getRequest.onerror = function (event) {
          console.error(
            "Erreur lors de la recherche du compte :",
            event.target.error
          );
        };
      });
    }

    function login() {
      const request = window.indexedDB.open("MaBaseDeDonnees", 1);

      // Gérer les événements associés à la requête
      request.addEventListener("success", function (event) {
        const db = event.target.result;
        const transaction = db.transaction(["Compte"], "readonly");
        const objectStore = transaction.objectStore("Compte");

        const email_input = document.getElementById("email").value;
        const password_input = document.getElementById("password").value;
        const index = objectStore.index("User");
        const getRequest = index.get(email_input);

        getRequest.onsuccess = function (event) {
          const storedUserData = event.target.result;

          if (storedUserData) {
            // La variable a été récupérée avec succès

            const { email, password, name, userId } = JSON.parse(
              storedUserData.value
            );
            async function verifyPassword(password_ver, storedHash) {
              console.log(password_ver);
              console.log(storedHash);
              // Split the stored hash into salt and hash
              const [saltHex, hashHex] = storedHash.split(":");

              // Convert salt from hex to ArrayBuffer
              const salt = new Uint8Array(
                saltHex.match(/.{1,2}/g).map((byte) => parseInt(byte, 16))
              );

              // Convert password to ArrayBuffer
              const encoder = new TextEncoder();
              const data = encoder.encode(password_ver);

              // Combine password and salt
              const saltedData = new Uint8Array(data.length + salt.length);
              saltedData.set(salt);
              saltedData.set(data, salt.length);

              // Hash the salted password
              const hashBuffer = await crypto.subtle.digest(
                "SHA-256",
                saltedData
              );
              const hashArray = Array.from(new Uint8Array(hashBuffer));

              // Convert hash to hex string
              const hashHexToCompare = hashArray
                .map((b) => b.toString(16).padStart(2, "0"))
                .join("");

              // Compare the hashes
              return hashHex === hashHexToCompare;
            }
            (async () => {
              // Vérification du mot de passe

              const isCorrect = await verifyPassword(password_input, password);

              if (isCorrect === true) {
                const newTransaction = db.transaction(
                  ["Connexion"],
                  "readwrite"
                );
                const newObjectStore = newTransaction.objectStore("Connexion");

                const newRequest = newObjectStore.put({
                  connexion: 1,
                  connected: "yes",
                  name_to_profil: name,
                  email: email,
                  id_to_create: userId,
                });
                newRequest.onsuccess = function (event) {
                  console.log(
                    "Variable ajoutée avec succès à la base de données."
                  );
                };

                // Stockez le nom de l'utilisateur dans le localStorage (si nécessaire)

                alert("Connexion réussie!");
                window.location.href = "menu_IDE.html";
                function getFormattedDateTime() {
                  const currentTime = new Date();

                  // Obtention des composants de la date
                  const day = currentTime.getDate();
                  const month = currentTime.getMonth() + 1; // Les mois sont indexés à partir de 0
                  const year = currentTime.getFullYear();

                  // Formater la date au format "dd-mm-yyyy"
                  const formattedDate = `${day < 10 ? "0" : ""}${day}-${
                    month < 10 ? "0" : ""
                  }${month}-${year}`;

                  // Obtention des composants de l'heure
                  const hours = currentTime.getHours();
                  const minutes = currentTime.getMinutes();

                  // Formater l'heure au format "hh:mm"
                  const formattedTime = `${hours < 10 ? "0" : ""}${hours}:${
                    minutes < 10 ? "0" : ""
                  }${minutes}`;

                  // Concaténer la date et l'heure dans la chaîne de caractères finale
                  return `${formattedDate} ${formattedTime}`;
                }
                updateDateTimeInUpdating();
                function updateDateTimeInUpdating() {
                  const formattedDateTime = getFormattedDateTime();
                  // Mettre à jour l'heure dans Updating
                  const transaction = db.transaction(["Updating"], "readwrite");
                  const objectStore = transaction.objectStore("Updating");
                  objectStore.put({
                    MAJ: formattedDateTime,
                    update: "maj_hour",
                  });
                }
              } else {
                alert("Mot de passe incorrect. Veuillez réessayer.");
              }
            })();
          } else {
            // La variable n'a pas été trouvée
            console.log("La variable n'a pas été trouvée.");
            alert("Utilisateur non trouvé. Veuillez vous inscrire.");
          }
        };
      });
    }
  </script>
</html>
